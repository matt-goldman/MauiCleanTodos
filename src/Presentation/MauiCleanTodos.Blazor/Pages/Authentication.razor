@page "/authentication/{action}"
@inject IAccessTokenProvider tokenProvider
@inject NavigationManager navigation

@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
<RemoteAuthenticatorView Action="@Action" OnLogInSucceeded="HandleLoginSucceeded" LogInFailed="LoginFailedFragment" />

@code{
    [Parameter] public string? Action { get; set; }

    public async void HandleLoginSucceeded()
    {
        var tokenResult = await tokenProvider.RequestAccessToken();
        
        if (tokenResult.TryGetToken(out var token))
        {
            navigation.NavigateTo("/todos");
        }
    }

    private RenderFragment LoginFailedFragment(string message)
    {
        Console.WriteLine(message);
        return builder =>
        {
            builder.OpenElement(0, "div");
            builder.AddAttribute(1, "class", "alert alert-danger");
            builder.AddAttribute(2, "role", "alert");
            builder.AddContent(3, $"There was an error trying to log you in: '{message}'");
            builder.CloseElement();
        };
    }
}
